# Thomas Hoffmann, EMBL Heidelberg, structures-it@embl.de, 2025/01
# Ruoshi Sun
# 2025-09-08
easyblock = 'CMakeMake'

name = 'dssp'
version = '4.4.10'

homepage = 'https://github.com/PDB-REDO/dssp'
description = """This is a rewrite of DSSP, now offering full mmCIF support. The difference with
previous releases of DSSP is that it now writes out an annotated mmCIF file by
default, storing the secondary structure information in the _struct_conf
category."""

toolchain = {'name': 'GCC', 'version': '11.4.0'}

github_account = 'PDB-REDO'
source_urls = [GITHUB_SOURCE]
sources = ['v%(version)s.tar.gz']

builddependencies = [
    ('cmake', '3.28.1', '', SYSTEM),
    ('libmcfp', '1.3.4'),
    ('boost', '1.83.0'),  # req. for testing
    ('mrc', '1.3.13'),
    ('catch2', '3.8.1'),
]

dependencies = [
    ('libcifpp', '7.0.8'),
]

configopts = '-DUSE_RSRC=ON -DFETCHCONTENT_FULLY_DISCONNECTED=ON -DCIFPP_SHARE_DIR=$EBROOTLIBCIFPP/share'

postinstallcmds = [
    'cd %(installdir)s/bin && ln -s mkdssp dssp',
    'cd %(installdir)s/share/man && ln -s mkdssp.1 dssp.1',
]

runtest = True

sanity_check_commands = ['dssp -h']
sanity_check_paths = {
    'files': ['bin/dssp'],
    'dirs': ['include', 'lib', 'share']
}

moduleclass = 'bio'
